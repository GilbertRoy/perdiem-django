{% extends "base.html" %}
{% load staticfiles %}
{% load thumbnail %}
{% load markdown_deux_tags %}
{% load music %}

{% block socialmeta %}
    <!-- Google+ data -->
    <meta itemprop="name" content="{{ album.name }} by {{ album.project.artist.name }}">
    <meta itemprop="description" content="Discover and invest in music like {{ album.name }} on PerDiem.">
    {% thumbnail album.photo.img "506" as thumb %}
        <meta itemprop="image" content="{{ thumb.url }}">
    {% endthumbnail %}
    <!-- Twitter Card data -->
    {% if album.project.artist.social_twitter %}
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="{{ artist.social_twitter.username_twitter }}">
        <meta name="twitter:title" content="{{ album.name }} by {{ album.project.artist.name }}">
        <meta name="twitter:description" content="Discover and invest in music like {{ album.name }} on PerDiem.">
        <meta name="twitter:creator" content="{{ artist.social_twitter.username_twitter }}">
        {% thumbnail album.project.artist.photo.img "208" as thumb %}
            <meta name="twitter:image:src" content="{{ thumb.url }}">
        {% endthumbnail %}
    {% endif %}
    <!-- Open Graph data -->
    <meta property="og:title" content="{{ album.name }} by {{ album.project.artist.name }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://{{ host }}{% url 'album' artist_slug=album.project.artist.slug album_slug=album.slug %}" />
    {% thumbnail album.photo.img "600" as thumb %}
        <meta property="og:image" content="{{ thumb.url }}" />
        <meta property="og:image:width" content="{{ thumb.width }}" />
        <meta property="og:image:height" content="{{ thumb.height }}" />
    {% endthumbnail %}
    <meta property="og:description" content="Discover and invest in music like {{ album.name }} on PerDiem." />
    <meta property="og:site_name" content="PERDIEM" />
{% endblock %}

{% block extrastyle %}
    <link rel="stylesheet" href="{% static "css/music/music.css" %}" type="text/css" charset="utf-8" />
{% endblock %}

{% block content %}
    <h3>{{ album.name }}</h3>
    <h4>BY {{ album.project.artist.name }}</h4>
    <ul class="tabs" data-tabs id="music-tabs">
        <li class="tabs-title is-active"><a href="#music-overview" aria-selected="true"><i class="fa fa-user fa-2x tab-icon" aria-hidden="true"></i><span class="artist-tab">Overview</span></a></li>
        <li class="tabs-title"><a href="#music-stats"><i class="fa fa-money fa-2x tab-icon" aria-hidden="true"></i><span class="artist-tab">Stats</span></a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="music-tabs">
        {% include "music/includes/music_detail_overview.html" %}
        {% include "music/includes/music_detail_stats.html" %}
    </div>
{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{% static "js/vendor/Chart.min.js" %}"></script>

    <script>
        {% if album.track_set.all %}
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [
                        {% for month_revenue in estimated_cumulative_revenue %}
                            "{{ month_revenue.month }}"{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'Estimated Revenue',
                            data: [
                                {% for month_revenue in estimated_cumulative_revenue %}
                                    {{ month_revenue.artist_revenue }}{% if not forloop.last %},{% endif %}
                                {% endfor %}
                            ],
                            backgroundColor: "#34495E"
                        },
                    ]
                }
            });
            var cta = document.getElementById("myChart2").getContext('2d');
            var myChart2 = new Chart(cta, {
                type: 'bar',
                data: {
                    labels: [
                        {% for disc in album.discs %}
                            {% for track in disc %}
                                "{{ track.name }}"{% if not forloop.last %},{% endif %}
                            {% endfor %}
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'Streams',
                            data: [
                                {% for disc in album.discs %}
                                   {% for track in disc %}
                                       {{ track.total_streams }}{% if not forloop.last %},{% endif %}
                                   {% endfor %}
                                   {% if not forloop.last %},{% endif %}
                               {% endfor %}
                            ],
                            backgroundColor: "#85929E"
                        }
                    ]
                }
            });

            var ctb = document.getElementById("myChart3").getContext('2d');
            var myChart3 = new Chart(ctb, {
                type: 'bar',
                data: {
                    labels: [
                        {% for disc in album.discs %}
                            {% for track in disc %}
                               "{{ track.name }}"{% if not forloop.last %},{% endif %}
                           {% endfor %}
                           {% if not forloop.last %},{% endif %}
                       {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'DOWNLOADS',
                            data: [
                                {% for disc in album.discs %}
                                    {% for track in disc %}
                                        {{ track.total_downloads }}{% if not forloop.last %},{% endif %}
                                    {% endfor %}
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            ],
                            backgroundColor: "#34495E"
                        }
                    ]
                }
            });
        {% endif %}
    </script>
{% endblock %}
