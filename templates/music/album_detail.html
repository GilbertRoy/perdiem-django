{% extends "base.html" %}
{% load staticfiles %}
{% load thumbnail %}
{% load markdown_deux_tags %}
{% load music %}

{% block content %}
    <h2>{{ album.name }}</h2>
    <h4>BY {{ album.project.artist.name }}</h4>
    <div class="project-image">
        {% thumbnail album.artwork.img "500x500" crop="center" as thumb %}
            <img src="{{ thumb.url }}" width="{{ thumb.width }}" height="{{ thumb.height }}" alt="{{ album.name }}" />
        {% endthumbnail %}
    </div>
    {% if album.albumbio %}
        <div class="album-bio">
            <p>{{ album.albumbio.bio|markdown }}</p>
        </div>
        <div class="break-small">
            <hr>
        </div>
    {% endif %}

    <h4>Listen</h4>
    <div class="marketplace-container">
        {% for marketplace_url in album.marketplaceurl_set.all %}
            <a href="{{ marketplace_url.url }}" target="_blank">
                {% with "img/marketplace/"|add:marketplace_url.medium|add:".svg" as medium_image %}
                    <img class="marketplace-icons" src="{% static medium_image %}" alt="{{ marketplace_url.get_medium_display }}" />
                {% endwith %}
            </a>
        {% endfor %}
    </div>
    {% if album.release_date %}
        <h5 class="padding">Release date: {{ album.release_date }}</h5>
    {% endif %}
    <div class="break-small">
        <hr>
    </div>
    <div>
    {% if user_is_investor %}
        <div class="download-container">
            <a class="download-button" href="{{ album.audio.get_temporary_url }}" download>
                Download
                <i class="fa fa-download" aria-hidden="true"></i>
            </a>
        </div>
        <div class="break-small">
            <hr>
        </div>
    {% endif %}

    <h3>REVENUE</h3>
        <div class="bar-chart">
            <canvas id="line-canvas" height="650px" width="1000px"></canvas>
        </div>
    </div>

    <br/>
    <br/>
    <h3>Streams / Downloads</h3>
    <div class="bar-chart">
            <canvas id="bar-canvas" height="450" width="600"></canvas>
    </div>
    {% block extrajs %}
    <script type="text/javascript">
        var randomScalingFactor = function(){ return Math.round(Math.random()*100)};
        var lineChartData = {
            labels : ["January","February","March","April","May","June","July"],
            datasets : [
                {
                    label: "Artist Revenue",
                    fillColor : "rgba(220,220,220,0.2)",
                    strokeColor : "rgba(220,220,220,1)",
                    pointColor : "rgba(220,220,220,1)",
                    pointStrokeColor : "#fff",
                    pointHighlightFill : "#fff",
                    pointHighlightStroke : "rgba(220,220,220,1)",
                    data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
                },
                {
                    label: "Investor income",
                    fillColor : "rgba(151,187,205,0.2)",
                    strokeColor : "rgba(151,187,205,1)",
                    pointColor : "rgba(151,187,205,1)",
                    pointStrokeColor : "#fff",
                    pointHighlightFill : "#fff",
                    pointHighlightStroke : "rgba(151,187,205,1)",
                    data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
                }
            ]
        }
        var randomScalingFactor = function(){ return Math.round(Math.random()*100)};

        var barChartData = {
            labels : ["Track 1","Track 2","Track 3","Track 4","Track 5","Track 6","Track 7"],
            datasets : [
                {
                    fillColor : "rgba(220,220,220,0.5)",
                    strokeColor : "rgba(220,220,220,0.8)",
                    highlightFill: "rgba(220,220,220,0.75)",
                    highlightStroke: "rgba(220,220,220,1)",
                    data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
                },
                {
                    fillColor : "rgba(151,187,205,0.5)",
                    strokeColor : "rgba(151,187,205,0.8)",
                    highlightFill : "rgba(151,187,205,0.75)",
                    highlightStroke : "rgba(151,187,205,1)",
                    data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
                }
            ]


        }
        window.onload = function(){
        var ctx = document.getElementById("line-canvas").getContext("2d");
        window.myLine = new Chart(ctx).Line(lineChartData, {
            responsive: true
        });
            var ctx = document.getElementById("bar-canvas").getContext("2d");
            window.myBar = new Chart(ctx).Bar(barChartData, {
                responsive : true
            });

    }


        </script>
        {% endblock %}

    <div class="break-small">
        <hr>
    </div>
    <script type="text/javascript" src="{% static "js/Chart.js" %}"></script>

{% endblock %}
