{% extends "base.html" %}
{% load staticfiles %}
{% load thumbnail %}
{% load markdown_deux_tags %}
{% load music %}

{% block extrastyle %}
    <link rel="stylesheet" href="{% static "css/music/music.css" %}" type="text/css" charset="utf-8" />
{% endblock %}

{% block content %}
    <h3>{{ album.name }}</h3>
    <h4>BY {{ album.project.artist.name }}</h4>
    <ul class="tabs" data-tabs id="music-tabs">
        <li class="tabs-title is-active"><a href="#music-overview" aria-selected="true"><i class="fa fa-user fa-2x tab-icon" aria-hidden="true"></i><span class="artist-tab">Overview</span></a></li>
        <li class="tabs-title"><a href="#music-stats"><i class="fa fa-money fa-2x tab-icon" aria-hidden="true"></i><span class="artist-tab">Stats</span></a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="music-tabs">
        {% include "music/includes/music_detail_overview.html" %}
        {% include "music/includes/music_detail_stats.html" %}
    </div>
{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{% static "js/vendor/Chart.min.js" %}"></script>

    <script>
        {% if album.track_set.all %}
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [
                        {% for month_revenue in estimated_cumulative_revenue %}
                            "{{ month_revenue.month }}"{% if not forloop.last %},{% endif %}
                     {% endfor %}
                 ],
                    datasets: [
                        {
                            label: 'Estimated Revenue',
                            data: [
                                {% for month_revenue in estimated_cumulative_revenue %}
                                    {{ month_revenue.artist_revenue }}{% if not forloop.last %},{% endif %}
                             {% endfor %}
                         ],
                            backgroundColor: "#34495E"
                        },
                    ]
                }
            });
            var cta = document.getElementById("myChart2").getContext('2d');
            var myChart2 = new Chart(cta, {
                type: 'bar',
                data: {
                    labels: [
                        {% for disc in album.discs %}
                        {% for track in disc %}
                           "{{ track.name }}"{% if not forloop.last %},{% endif %}
                       {% endfor %}
                       {% if not forloop.last %},{% endif %}
                   {% endfor %}
               ],
                    datasets: [
                        {
                            label: 'Streams',
                            data: [
                                {% for disc in album.discs %}
                                   {% for track in disc %}
                                       {{ track.total_streams }}{% if not forloop.last %},{% endif %}
                                   {% endfor %}
                                   {% if not forloop.last %},{% endif %}
                               {% endfor %}
                            ],
                            backgroundColor: "#85929E"
                        }
                    ]
                }
            });

            var ctb = document.getElementById("myChart3").getContext('2d');
            var myChart3 = new Chart(ctb, {
                type: 'bar',
                data: {
                    labels: [
                        {% for disc in album.discs %}
                            {% for track in disc %}
                               "{{ track.name }}"{% if not forloop.last %},{% endif %}
                           {% endfor %}
                           {% if not forloop.last %},{% endif %}
                       {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'DOWNLOADS',
                            data: [
                                {% for disc in album.discs %}
                                {% for track in disc %}
                                    {{ track.total_downloads }}{% if not forloop.last %},{% endif %}
                               {% endfor %}
                               {% if not forloop.last %},{% endif %}
                           {% endfor %}
                       ],
                            backgroundColor: "#34495E"
                        }
                    ]
                }
            });
        {% endif %}
    </script>
{% endblock %}
